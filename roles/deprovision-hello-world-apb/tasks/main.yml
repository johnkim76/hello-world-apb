#############################################################################
# Deprovision hello-world
# This role executes much of the needed functionality to deprovision an
# application using an Ansible Playbook Bundle and delete resources created
# in the sample apb generated by the provision role.
#############################################################################

- name: update_last_op
  asb_last_operation:
    description: "[hello-world]: Starting Deprovision"

#############################################################################
# Deprovision a route
#############################################################################
- openshift_v1_route:
    name: hello-world
    namespace: '{{ namespace }}'
    state: absent

- name: update_last_op
  asb_last_operation:
    description: "[hello-world]: Finished removing DC [step 1/3]"

#############################################################################
# Deprovision a service
#############################################################################
- k8s_v1_service:
    name: hello-world
    namespace: '{{ namespace }}'
    state: absent

- name: update_last_op
  asb_last_operation:
    description: "[hello-world]: Finished removing service [step 2/3]"

#############################################################################
# Deprovision a deployment config
# When removing a Deployment Config, OpenShift will automatically clean up
# its associated resources like replication controllers and pods
#############################################################################
# Delete the deployment config.
- openshift_v1_deployment_config:
    name: hello-world
    namespace: '{{ namespace }}'
    state: absent

- name: update_last_op
  asb_last_operation:
    description: "[hello-world]: Finished removing route [step 3/3]"
